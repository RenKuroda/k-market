## Phase構成（0 → 1 → 2）

MVPは「最小で成立する取引フロー」を **Phase0/1/2** に分割して段階的に実装する。

- **Phase 0（土台）**: 認証基盤（Supabase Auth + `public.users` + `companies`）とRLSの骨格
- **Phase 1（最初に触れる体験）**: 出品（供給側）と検索/閲覧（需要側・未ログイン）
- **Phase 2（取引成立まで）**: 見積→回答→発注→案件管理＋運営管理

## Phase 0（土台）

### 範囲（Scope）

- **DB（最小）**
  - `public.companies`
  - `public.users`（`auth.users` と連携）
- **RLS（最小）**
  - `public.users`: 自分のみ select/update、運営は全件 select
  - `public.companies`: 自分の company のみ select（ACTIVEのみ）、運営は全件 select
- **API/操作（論理）**
  - Auth（Supabase Auth）
  - `GET /auth/me` 相当（ログイン状態確認）
  - `GET /companies/{id}`（自社情報取得）
- **画面（最小）**
  - `認証（ログイン/会員登録）`
  - `需要側ダッシュボード（空の案件一覧でOK）`
  - `供給側ダッシュボード（空の出品一覧でOK）`

### 成果物（Deliverables）

- Supabaseプロジェクト上で `companies/users` のテーブルが作成されている
- Supabase Auth でサインアップ/ログインできる
- `public.users` が `auth.users.id`（UUID）を参照し、role/companyが保持できる
- RLSで「自分のデータだけ」アクセスできる

### 完了条件（DoD）

- 需要側/供給側の企業としてサインアップ→ログイン→ログアウトできる（ログアウトはSDK機能で可）
- ログイン後、UI上で「ログイン中ユーザー」「所属会社」が確認できる（`auth/me` 相当）
- `public.users` は **自分のレコードのみ** select/update できる（運営は全件 select）
- `public.companies` は **自分の company かつ ACTIVE のみ** select できる（運営は全件 select）

## Phase 1（最初に触れる体験：出品＋検索/閲覧）

### 範囲（Scope）

- **DB**
  - `public.machines`
- **RLS（方針）**
  - 供給側（company_id一致）: 自社出品の CRUD
  - 需要側（ログイン済み）: 掲載中（PUBLISHED）の機械を select
  - 未ログイン: **簡易検索のみ**（実装は view / RPC / Edge Function などでマスクして提供）
- **画面**
  - `ログイン前トップ/簡易検索`
  - `機械検索/一覧`
  - `機械詳細`
  - `機械登録/編集`
  - `供給側ダッシュボード（出品一覧）`

### 完了条件（DoD）

- 供給側が機械を登録し、掲載/停止を切替できる
- 未ログインで簡易検索ができ、在庫感/相場感がわかる（詳細は制限）
- ログイン後、需要側が検索→詳細閲覧まで到達できる

## Phase 2（取引成立まで：見積→回答→発注→案件管理＋運営）

### 範囲（Scope）

- **DB**
  - `public.quote_requests`
  - `public.quote_responses`
  - `public.orders`
- **RLS（方針）**
  - 見積依頼: 需要側は作成/閲覧（自社のみ）、供給側は閲覧（自社宛のみ）
  - 見積回答: 供給側は作成/更新（自社のみ）、需要側は閲覧（自社依頼分のみ）
  - 案件: 需要側/供給側が閲覧（当事者のみ）
  - 運営: 企業/出品/案件の管理（停止・ステータス更新）
- **通知（最小）**
  - 見積依頼作成、見積回答作成、発注確定をメール通知（詳細は `07_nonfunctional.md`）
- **画面**
  - 需要側: `見積依頼作成`、`見積・案件詳細（需要側）`、`需要側ダッシュボード（案件一覧）`
  - 供給側: `見積・案件詳細（供給側）`、`供給側ダッシュボード（見積/案件一覧）`
  - 運営: `運営ログイン`、`運営ダッシュボード`、`企業一覧+詳細`、`出品一覧+詳細`、`案件一覧+詳細`

### 完了条件（DoD）

- 需要側が見積依頼を作成できる
- 供給側が見積回答を返せる
- 需要側が見積回答を確認し、発注確定できる
- 双方が案件一覧/詳細で状況を追える（見積中/発注済/完了）
- 運営が企業を有効/無効にでき、出品の掲載/停止ができ、案件一覧を確認できる

## スコープブレ防止（明示）

- MVPでは **決済・チャット・カレンダー** は作らない
- レビュー/評価、PDF自動生成、一括見積は後回し

### 変更履歴

| 更新日 | 更新者 | 変更内容 |
|---|---|---|
| 2025-12-26 | PM（AI） | 新規作成 |


